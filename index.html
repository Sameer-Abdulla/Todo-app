<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        form {
            margin-bottom: 20px;
        }
        input, select, textarea, button {
            margin: 5px 0;
            padding: 10px;
            width: 100%;
        }
        .task-list {
            margin-top: 20px;
        }
        .task-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Task Manager</h1>

    <form id="task-form">
        <h2>Create a New Task</h2>
        <label for="title">Title</label>
        <input type="text" id="title" name="title" required>

        <label for="description">Description</label>
        <textarea id="description" name="description"></textarea>

        <label for="due_at">Due Date and Time (with Timezone)</label>
        <input type="datetime-local" id="due_at" name="due_at" required>

        <label for="priority">Priority</label>
        <select id="priority" name="priority">
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
        </select>

        <button type="submit">Create Task</button>
    </form>

    <div class="task-list" id="task-list">
        <h2>Task List</h2>
        <!-- Task items will be displayed here -->
    </div>

    <script>
        const taskForm = document.getElementById('task-form');
        const taskList = document.getElementById('task-list');
    
        // Helper function to fetch tasks and display them
        async function fetchTasks() {
            try {
                const response = await fetch('http://127.0.0.1:8000/tasks/'); // API endpoint
                if (!response.ok) {
                    throw new Error(`Error fetching tasks: ${response.status} ${response.statusText}`);
                }
                const tasks = await response.json();
                taskList.innerHTML = '<h2>Task List</h2>';
                if (tasks.length === 0) {
                    taskList.innerHTML += '<p>No tasks available.</p>';
                } else {
                    tasks.forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.className = 'task-item';
                        taskItem.innerHTML = `
                            <strong>${task.title}</strong> (${task.priority})<br>
                            ${task.description || 'No description'}<br>
                            Due At: ${new Date(task.due_at).toLocaleString()}<br>
                            Completed: ${task.completed ? 'Yes' : 'No'}
                        `;
                        taskList.appendChild(taskItem);
                    });
                }
            } catch (error) {
                console.error(error);
                taskList.innerHTML = '<p>Error loading tasks. Please try again later.</p>';
            }
        }
    
        // Handle form submission to create a new task
        taskForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(taskForm);
            const taskData = {
                title: formData.get('title'),
                description: formData.get('description'),
                due_at: new Date(formData.get('due_at')).toISOString(), // Convert to ISO string
                priority: formData.get('priority'),
                completed: false,
            };
    
            try {
                const response = await fetch('http://127.0.0.1:8000/tasks/', { // API endpoint
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData),
                });
    
                if (response.ok) {
                    alert('Task created successfully!');
                    taskForm.reset();
                    fetchTasks(); // Refresh task list
                } else {
                    const errorData = await response.json();
                    alert(`Error creating task: ${errorData.detail || response.statusText}`);
                }
            } catch (error) {
                console.error('Error creating task:', error);
                alert('An error occurred while creating the task.');
            }
        });
    
        // Fetch and display tasks on page load
        fetchTasks();
    </script>
    
</body>
</html>
